---

export function createPages() {
  return {
    route: `/grouped/:name`,
    data() {
      const allPosts = Astro.fetchContent('./post/**/*.md');
      const allAuthors = allPosts.map(p => p.author);
      const uniqueAuthors = [...new Set(allAuthors)];
      return {uniqueAuthors, allPosts};
    }
    params({data}) {
      data.uniqueAuthors.map(author => {
        const params = { name: author };
        return params;
      });
    },
    async props({ params, data }) {
      return {posts: data.allPosts.filter(p => p.author === params.name)}
    },
  };
}

const { posts } = Astro.props;
const { params } = Astro.request;
---

<div id={params.name}>
  {posts.data.map((post) => (
    <a href={post.url}>{post.title}</a>
   ))}
</div>
