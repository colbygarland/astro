---

export async function createPages() {
  const allPosts = Astro.fetchContent('./post/**/*.md');
  const allAuthors = allPosts.map(p => p.author);
  const uniqueAuthors = [...new Set(allAuthors)];
  return {
    route: `/grouped/:name`,
    pages: uniqueAuthors.map(author => {
        const params = { name: author };
        return params;
    }),
    async props({ params }) {
        return {posts: allPosts.filter(p => p.author === params.name)}
    },
  };
}

const { posts } = Astro.props;
const { params } = Astro.request;
---

<div id={params.name}>
  {posts.data.map((post) => (
    <a href={post.url}>{post.title}</a>
   ))}
</div>
